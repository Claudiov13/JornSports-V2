<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jorn Sports Analytics - Futebol</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Config Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
        extend: {
          colors: {
            sport: {
              50: '#F8FBFF',
              100: '#ECF4FF',
              200: '#CFE5FF',
              300: '#A6D0FF',
              400: '#6BB0FF',
              500: '#3C91FF',
              600: '#1E6FE6',
              700: '#1555B4',
              800: '#103E84',
              900: '#0C2C5C'
            },
            neon: '#00FFC6',
          },
          boxShadow: {
            sport: '0 10px 30px rgba(60,145,255,0.25)'
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="/public/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
  <!-- Seu JS -->
  <script src="/public/script.js"></script>

  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-900 text-white font-sans">

  <!-- NAV -->
  <header class="sticky top-0 z-40 header-glass header-shadow">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="#" class="flex items-center gap-3 group">
        <div class="h-9 w-9 rounded-xl bg-teal-400/10 border border-teal-300/30 flex items-center justify-center shadow-sport">
          <span class="text-neon font-extrabold">J</span>
        </div>
        <span class="font-semibold tracking-wide text-white/90 group-hover:text-white transition">Jorn Sports</span>
      </a>

      <nav id="nav-menu" class="hidden md:flex items-center gap-6 text-sm text-white/80">
        <a href="#auth-section" class="nav-link hover:text-white transition">Acesso</a>
        <a href="#players-section" class="nav-link hover:text-white transition">Atletas</a>
        <a href="#upload-section" class="nav-link hover:text-white transition">Upload</a>
        <a href="#alerts-section" class="nav-link hover:text-white transition">Alertas</a>
        <a href="#form-container" class="nav-link hover:text-white transition">Formulário</a>
        <a href="#results" class="nav-link hover:text-white transition">Resultados</a>
      </nav>

      <button id="nav-toggle" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg btn-ghost" aria-label="Abrir menu">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div id="nav-drawer" class="md:hidden hidden px-4 pb-3">
      <nav class="flex flex-col gap-2 text-sm text-white/90 bg-white/5 border border-white/10 rounded-xl p-3">
        <a href="#auth-section" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Acesso</a>
        <a href="#players-section" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Atletas</a>
        <a href="#upload-section" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Upload</a>
        <a href="#alerts-section" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Alertas</a>
        <a href="#form-container" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Formulário</a>
        <a href="#results" class="nav-link block px-3 py-2 rounded-lg hover:bg-white/10">Resultados</a>
      </nav>
    </div>
  </header>

  <!-- Modal: Relatórios salvos -->
  <div id="reports-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-lg shadow-xl w-full md:w-3/4 lg:w-2/3 max-h-[90vh] flex flex-col">
      <div class="p-4 border-b border-gray-700 flex justify-between items-center">
        <h2 class="text-2xl font-bold text-orange-400">Relatórios Salvos</h2>
        <button id="close-modal-btn" class="text-gray-400 hover:text-white text-4xl leading-none">&times;</button>
      </div>
      <div class="p-6 overflow-y-auto flex-grow" id="reports-list-container"></div>
    </div>
  </div>

  <!-- Modal: Detalhe do Atleta -->
  <div id="player-detail-modal" class="hidden fixed inset-0 bg-black/80 z-50 p-4 overflow-y-auto">
    <div class="max-w-5xl mx-auto bg-gray-850 bg-gray-800 rounded-2xl border border-white/10 shadow-2xl">
      <div class="flex items-center justify-between px-5 py-4 border-b border-white/10">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-full bg-white/10 flex items-center justify-center">
            <span id="player-detail-initials" class="font-bold">A</span>
          </div>
          <div>
            <h3 id="player-detail-name" class="text-xl font-semibold"></h3>
            <p id="player-detail-meta" class="text-xs text-white/60"></p>
          </div>
        </div>
        <button id="close-player-modal" class="px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20">Fechar</button>
      </div>

      <div class="p-5 grid grid-cols-1 lg:grid-cols-3 gap-5">
        <!-- Coluna esquerda: Alertas e Relatórios -->
        <div class="space-y-5 lg:col-span-1">
          <div class="bg-white/5 border border-white/10 rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
              <h4 class="font-semibold text-orange-400">Alertas</h4>
              <span id="player-detail-unread" class="text-xs bg-red-500/20 text-red-300 px-2 py-0.5 rounded-full">0</span>
            </div>
            <div id="player-alerts" class="space-y-2 text-sm"></div>
          </div>

          <div class="bg-white/5 border border-white/10 rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
              <h4 class="font-semibold text-orange-400">Relatórios salvos</h4>
              <button id="open-saved-reports" class="text-xs bg-white/10 px-2 py-1 rounded hover:bg-white/20">Ver todos</button>
            </div>
            <div id="player-reports" class="space-y-2 text-sm"></div>
          </div>
        </div>

        <!-- Coluna central/direita: Métricas -->
        <div class="bg-white/5 border border-white/10 rounded-xl p-4 lg:col-span-2">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
              <h4 class="font-semibold text-orange-400">Histórico de Métricas</h4>
              <p class="text-xs text-white/60">Selecione uma métrica para visualizar o gráfico</p>
            </div>
            <div class="flex items-center gap-2">
              <label for="metric-filter" class="text-sm text-white/70">Métrica:</label>
              <select id="metric-filter" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-sm">
              </select>
            </div>
          </div>

          <div class="mt-4">
            <canvas id="metricChart" class="w-full h-64"></canvas>
          </div>

          <div class="mt-6">
            <div class="overflow-x-auto rounded-lg border border-white/10">
              <table class="min-w-full text-sm">
                <thead class="bg-white/10 text-white/80">
                  <tr>
                    <th class="px-3 py-2 text-left">Data</th>
                    <th class="px-3 py-2 text-left">Métrica</th>
                    <th class="px-3 py-2 text-left">Valor</th>
                    <th class="px-3 py-2 text-left">Unidade</th>
                  </tr>
                </thead>
                <tbody id="measurements-table" class="divide-y divide-white/5"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div> <!-- /grid -->

    </div>
  </div>

  <div class="container mx-auto p-4 md:p-8">

    <!-- Hero -->
    <header class="text-center mb-10">
      <div class="flex justify-center items-center mb-4">
        <h1 class="text-4xl md:text-5xl font-black tracking-wider">
          <span class="text-orange-500">JORN</span> <span class="text-white">SPORTS</span>
        </h1>
      </div>
      <p class="text-gray-300 text-lg">Análise de Potencial e Desempenho para Atletas de Futebol</p>
    </header>

    <!-- Autenticação -->
    <section id="auth-section" class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700 mb-8">
      <h2 class="text-2xl font-semibold text-orange-400 mb-4">Acesso do Técnico</h2>
      <form id="login-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="login-email" class="block text-sm font-medium text-gray-300 mb-1">E-mail</label>
            <input type="email" id="login-email" name="email" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="tecnico@clube.com" autocomplete="email" required>
          </div>
          <div>
            <label for="login-password" class="block text-sm font-medium text-gray-300 mb-1">Senha</label>
            <input type="password" id="login-password" name="password" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="*******" autocomplete="current-password" required>
          </div>
        </div>
        <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition">Entrar</button>
      </form>
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mt-4">
        <p id="auth-status" class="hidden text-sm text-gray-300" aria-live="polite"></p>
        <button type="button" id="logout-btn" class="hidden bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition">Sair</button>
      </div>
    </section>

    <!-- CONTEUDO PROTEGIDO -->
    <div id="protected-content" class="hidden space-y-8">

      <nav id="view-tabs" class="bg-gray-800 p-3 rounded-lg border border-gray-700 shadow-lg">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
          <button type="button" class="view-tab-button active" data-view-target="manual">Cadastro manual</button>
          <button type="button" class="view-tab-button" data-view-target="players">Atletas</button>
          <button type="button" class="view-tab-button" data-view-target="data">Importacoes &amp; alertas</button>
          <button type="button" class="view-tab-button" data-view-target="analysis">Formularios IA</button>
        </div>
      </nav>

      <section id="manual-section" data-view-section="manual" class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-6">
          <div>
            <h2 class="text-2xl font-semibold text-orange-400">Cadastro manual de atletas</h2>
            <p class="text-sm text-white/70 mt-2 max-w-2xl">
              Gere um identificador exclusivo para cada atleta vinculado ao seu clube. O codigo segue o
              padrao <span class="font-semibold text-orange-400">CLBCOD + CODTEC + numero sequencial</span>,
              como <span class="font-semibold text-white/90">FLAPRO001</span>.
            </p>
          </div>
          <div class="text-sm text-white/60 bg-white/5 border border-white/10 rounded-lg p-4 max-w-sm">
            <p class="font-semibold text-white/80 mb-2">Dica de preenchimento</p>
            <ul class="list-disc list-inside space-y-1">
              <li>Clube e tecnico geram automaticamente os codigos (edite se preferir).</li>
              <li>Reaproveite o mesmo tecnico para manter o prefixo alinhado (ex.: PRO).</li>
              <li>O numero sequencial e calculado para cada combinacao clube+tecnico.</li>
            </ul>
          </div>
        </div>

        <form id="manual-player-form" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="manual-first-name" class="block text-sm font-medium text-gray-300 mb-1">Nome do atleta *</label>
            <input type="text" id="manual-first-name" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Pedro" required>
          </div>
          <div>
            <label for="manual-last-name" class="block text-sm font-medium text-gray-300 mb-1">Sobrenome</label>
            <input type="text" id="manual-last-name" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Araujo">
          </div>
          <div>
            <label for="manual-club-name" class="block text-sm font-medium text-gray-300 mb-1">Clube *</label>
            <input type="text" id="manual-club-name" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Flamengo" required>
          </div>
          <div>
            <label for="manual-club-code" class="block text-sm font-medium text-gray-300 mb-1">Codigo do clube</label>
            <input type="text" id="manual-club-code" maxlength="6" class="w-full uppercase bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="FLA">
          </div>
          <div>
            <label for="manual-coach-name" class="block text-sm font-medium text-gray-300 mb-1">Tecnico responsavel *</label>
            <input type="text" id="manual-coach-name" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Rafael" required>
          </div>
          <div>
            <label for="manual-coach-code" class="block text-sm font-medium text-gray-300 mb-1">Codigo do tecnico</label>
            <input type="text" id="manual-coach-code" maxlength="6" class="w-full uppercase bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="PRO">
          </div>
          <div class="md:col-span-2 flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-2">
            <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition">Gerar ID do atleta</button>
            <p class="text-xs text-white/50">Os campos marcados com * sao obrigatorios.</p>
          </div>
        </form>

        <div id="manual-player-feedback" class="hidden mt-6 bg-white/5 border border-white/10 rounded-lg p-4">
          <p class="text-sm text-white/70">ID gerado para o atleta:</p>
          <div id="manual-player-id-preview" class="text-3xl font-black text-orange-400 tracking-wide mt-2">---</div>
          <p id="manual-player-message" class="text-sm text-white/60 mt-3"></p>
        </div>
      </section>

      <!-- Diretório de Atletas --><!-- NOVO: Diretório de Atletas -->
      <!-- Diretório de Atletas -->
      <section id="players-section" data-view-section="players" class="hidden bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div>
            <h2 class="text-2xl font-semibold text-orange-400">Atletas cadastrados</h2>
            <p class="text-sm text-white/60 mt-1">Acompanhe todos os atletas vinculados ao seu clube e técnico.</p>
          </div>
          <div class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
            <input id="players-search" type="search" placeholder="Buscar por nome ou ID..." class="bg-gray-700 border border-gray-600 rounded-md p-2 text-sm w-full md:w-56" />
            <select id="players-club-filter" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-sm w-full md:w-40">
              <option value="">Todos os clubes</option>
            </select>
            <select id="players-coach-filter" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-sm w-full md:w-40">
              <option value="">Todos os tecnicos</option>
            </select>
            <button id="players-refresh" class="bg-white/10 hover:bg-white/20 text-white font-semibold py-2 px-3 rounded-lg text-sm">Atualizar</button>
          </div>
        </div>

        <div class="mt-4 overflow-x-auto rounded-lg border border-white/10">
          <table class="min-w-full text-sm">
            <thead class="bg-white/10 text-white/80">
              <tr>
                <th class="px-3 py-2 text-left">ID do atleta</th>
                <th class="px-3 py-2 text-left">Nome</th>
                <th class="px-3 py-2 text-left">Clube</th>
                <th class="px-3 py-2 text-left">Tecnico</th>
                <th class="px-3 py-2 text-left">Metricas</th>
                <th class="px-3 py-2 text-left">Ultimo registro</th>
                <th class="px-3 py-2 text-left">Alertas</th>
                <th class="px-3 py-2"></th>
              </tr>
            </thead>
            <tbody id="players-table" class="divide-y divide-white/5">
              <!-- linhas renderizadas via script.js -->
            </tbody>
          </table>
        </div>
      </section>
      <div data-view-section="data" class="hidden space-y-8">
        <section id="upload-section" class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
              <h2 class="text-2xl font-semibold text-orange-400">Importar dados de GPS/HRV</h2>
              <p class="text-sm text-white/60 mt-1">Aceita CSV em formato largo ou longo. Utilize o ID gerado para identificar o atleta dentro do arquivo quando possivel.</p>
            </div>
          </div>
          <div class="mt-4 flex flex-col md:flex-row md:items-center gap-3">
            <input type="file" id="csv-file" accept=".csv" class="text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-500 file:text-white hover:file:bg-orange-600">
            <button id="upload-csv-btn" class="bg-white/10 hover:bg-white/20 text-white font-semibold py-2 px-4 rounded-lg transition">Enviar CSV</button>
          </div>
          <p id="upload-status" class="text-sm text-gray-300 mt-3"></p>
        </section>

        <section id="alerts-section" class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
              <h2 class="text-2xl font-semibold text-orange-400">Alertas ativos</h2>
              <p class="text-sm text-white/60 mt-1">Selecione um atleta para gerar novos alertas automáticos baseados nas métricas recentes.</p>
            </div>
            <div class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
              <select id="alerts-player-selector" class="bg-gray-700 border border-gray-600 rounded-md p-2 text-sm w-full md:w-48">
                <option value="">Todos os atletas</option>
              </select>
              <button id="generate-alerts-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition">Gerar alertas</button>
              <button id="refresh-alerts" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition">Atualizar</button>
            </div>
          </div>
          <div id="alerts-container" class="mt-4 space-y-3"></div>
        </section>
      </div>

      <div data-view-section="analysis" class="hidden space-y-6">
        <div class="text-center mb-4">
          <button id="view-reports-btn" class="bg-gray-700 hover:bg-gray-600 text-orange-400 font-bold py-2 px-6 rounded-lg transition">Ver Relatorios Salvos</button>
        </div>

<!-- Erros do formulario -->
      <div id="error-container" role="alert" aria-live="assertive" aria-atomic="true" aria-labelledby="error-title" tabindex="-1" class="hidden bg-red-900 border border-red-500 text-red-300 px-4 py-3 rounded-lg mb-6">
        <strong id="error-title" class="font-bold">Dados Incompletos ou Inválidos!</strong>
        <ul id="error-list" class="mt-2 list-disc list-inside"></ul>
      </div>

      <!-- FORM principal (mantido) -->
      <main id="form-container" class="space-y-8">

        <!-- 1. Perfil do Atleta -->
        <section class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <h2 class="text-2xl font-semibold mb-6 text-orange-400 border-b-2 border-orange-500 pb-2">1. Perfil do Atleta</h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
            <div class="lg:col-span-1">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                  <label for="nome" class="block text-sm font-medium text-gray-300 mb-1">Nome <span class="text-red-500">*</span></label>
                  <input type="text" id="nome" name="Nome" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Apenas letras" required pattern="[a-zA-Z\s]+">
                </div>
                <div>
                  <label for="sobrenome" class="block text-sm font-medium text-gray-300 mb-1">Sobrenome <span class="text-red-500">*</span></label>
                  <input type="text" id="sobrenome" name="Sobrenome" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Apenas letras" required pattern="[a-zA-Z\s]+">
                </div>
                <div>
                  <label for="idade" class="block text-sm font-medium text-gray-300 mb-1">Idade <span class="text-red-500">*</span></label>
                  <input type="number" id="idade" name="Idade" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Anos" required min="4" max="50">
                </div>
              </div>

              <div class="mb-4">
                <label for="posicao_atual" class="block text-base font-medium text-gray-300 mb-1">Posição Principal</label>
                <select id="posicao_atual" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-base md:text-lg leading-relaxed focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none">
                  <option value="default" selected disabled>Selecione</option>
                  <option value="goleiro">Goleiro</option>
                  <option value="zagueiro">Zagueiro</option>
                  <option value="lateral">Lateral</option>
                  <option value="volante">Volante</option>
                  <option value="meia">Meio-campista</option>
                  <option value="ponta">Ponta</option>
                  <option value="atacante">Atacante</option>
                </select>
              </div>

              <div class="mb-4">
                <label for="pe_dominante" class="block text-base font-medium text-gray-300 mb-1">Pé Dominante</label>
                <select id="pe_dominante" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-base md:text-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none">
                  <option value="default" selected disabled>Selecione</option>
                  <option value="direito">Direito</option>
                  <option value="esquerdo">Esquerdo</option>
                  <option value="ambidestro">Ambidestro</option>
                </select>
              </div>
            </div>

            <!-- Campo tático -->
            <div class="lg:col-span-1 flex items-start justify-end">
              <div id="tactical-map-container" class="bg-gray-700 p-3 rounded-lg flex items-center justify-center w-full max-w-[420px]">
                <svg id="tactical-map" viewBox="0 0 300 200" class="w-full h-auto max-h-44">
                  <defs>
                    <radialGradient id="heatGradient" cx="50%" cy="50%" r="50%">
                      <stop offset="0%" stop-color="rgba(249,115,22,0.95)"/>
                      <stop offset="60%" stop-color="rgba(249,115,22,0.65)"/>
                      <stop offset="100%" stop-color="rgba(249,115,22,0)"/>
                    </radialGradient>
                  </defs>

                  <rect width="300" height="200" fill="#163D2A"/>
                  <rect x="10" y="10" width="280" height="180" fill="none" stroke="#f97316" stroke-width="2"/>
                  <line x1="150" y1="10" x2="150" y2="190" stroke="#f97316" stroke-width="2"/>
                  <circle cx="150" cy="100" r="18" fill="none" stroke="#f97316" stroke-width="2"/>
                  <circle cx="150" cy="100" r="2" fill="#f97316"/>
                  <rect x="250" y="60" width="30" height="80" fill="none" stroke="#f97316" stroke-width="2"/>
                  <rect x="20" y="60" width="30" height="80" fill="none" stroke="#f97316" stroke-width="2"/>

                  <ellipse id="heat-goleiro"  class="heatmap" cx="40"  cy="100" rx="40" ry="60" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-zagueiro" class="heatmap" cx="90"  cy="100" rx="60" ry="70" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-lateral"  class="heatmap" cx="70"  cy="100" rx="30" ry="80" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-volante"  class="heatmap" cx="120" cy="110" rx="80" ry="60" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-meia"     class="heatmap" cx="160" cy="100" rx="90" ry="70" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-ponta"    class="heatmap" cx="220" cy="100" rx="30" ry="80" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                  <ellipse id="heat-atacante" class="heatmap" cx="260" cy="100" rx="40" ry="60" fill="url(#heatGradient)" style="opacity:0; transition:opacity .35s ease;"/>
                </svg>
              </div>
            </div>
          </div>

          <script>
            (function(){
              const nome = document.getElementById('nome');
              const sobrenome = document.getElementById('sobrenome');
              const initialsEl = document.getElementById('avatar-initials');
              function updateInitials(){
                if(!initialsEl) return;
                const n = (nome.value || '').trim();
                const s = (sobrenome.value || '').trim();
                const inits = ((n[0]||'') + (s[0]||'')).toUpperCase() || 'JD';
                initialsEl.textContent = inits;
              }
              nome && nome.addEventListener('input', updateInitials);
              sobrenome && sobrenome.addEventListener('input', updateInitials);
              updateInitials();
            })();

            (function(){
              const mapping = {
                'goleiro':  'heat-goleiro',
                'zagueiro': 'heat-zagueiro',
                'lateral':  'heat-lateral',
                'volante':  'heat-volante',
                'meia':     'heat-meia',
                'ponta':    'heat-ponta',
                'atacante': 'heat-atacante'
              };
              const heatElements = {};
              Object.values(mapping).forEach(id => {
                const el = document.getElementById(id);
                if(el){ heatElements[id] = el; el.style.opacity = 0; el.style.pointerEvents = 'none'; }
              });
              function hideAll(){ Object.values(heatElements).forEach(el => el.style.opacity = 0); }
              function showHeatmapFor(positionKey){
                hideAll();
                const id = mapping[positionKey];
                const el = heatElements[id];
                if(el){ requestAnimationFrame(() => { el.style.opacity = 0.92; }); }
              }
              const select = document.getElementById('posicao_atual');
              if(!select) return;
              select.addEventListener('change', (e) => { showHeatmapFor(e.target.value); });
              if(select.value && select.value !== 'default'){ showHeatmapFor(select.value); }
            })();
          </script>
        </section>

        <!-- 2. Dados Antropométricos -->
        <section class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <h2 class="text-2xl font-semibold mb-6 text-orange-400 border-b-2 border-orange-500 pb-2">2. Dados Antropométricos</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div>
              <label for="altura" class="block text-sm font-medium text-gray-300 mb-1">Altura (cm) <span class="text-red-500">*</span></label>
              <input type="number" id="altura" name="Altura" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Ex: 182" required>
            </div>
            <div>
              <label for="peso" class="block text-sm font-medium text-gray-300 mb-1">Peso (kg) <span class="text-red-500">*</span></label>
              <input type="number" id="peso" name="Peso" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Ex: 78" required>
            </div>
            <div>
              <label for="envergadura" class="block text-sm font-medium text-gray-300 mb-1">Envergadura (cm) (Opcional)</label>
              <input type="number" id="envergadura" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Ex: 185">
            </div>
            <div>
              <label for="percentual_gordura" class="block text-sm font-medium text-gray-300 mb-1">% Gordura (Opcional)</label>
              <input type="text" inputmode="decimal" id="percentual_gordura" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Ex: 8,5">
            </div>
          </div>
        </section>

        <!-- 3. Capacidades Físicas -->
        <section class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <h2 class="text-2xl font-semibold mb-6 text-orange-400 border-b-2 border-orange-500 pb-2">3. Capacidades Físicas</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div>
              <label for="velocidade_sprint" class="block text-sm font-medium text-gray-300 mb-1">Velocidade (Sprint 20m) (Opcional)</label>
              <input type="number" id="velocidade_sprint" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Segundos">
            </div>
            <div>
              <label for="salto_vertical" class="block text-sm font-medium text-gray-300 mb-1">Salto Vertical (cm) (Opcional)</label>
              <input type="number" id="salto_vertical" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Altura em cm">
            </div>
            <div>
              <label for="agilidade" class="block text-sm font-medium text-gray-300 mb-1">Agilidade (T-Test) (Opcional)</label>
              <input type="number" id="agilidade" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Segundos">
            </div>
            <div>
              <label for="resistencia" class="block text-sm font-medium text-gray-300 mb-1">Resistência (Yo-Yo Test) (Opcional)</label>
              <input type="text" id="resistencia" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none" placeholder="Nível/Distância">
            </div>
          </div>
        </section>

        <!-- 4. Habilidades Técnicas -->
        <section class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
          <h2 class="text-2xl font-semibold mb-6 text-orange-400 border-b-2 border-orange-500 pb-2">4. Habilidades Técnicas</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
            <div class="slider-container">
              <label for="controle_bola" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Controle de Bola</span><span id="controle_bola_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="controle_bola" name="Controle de Bola" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="drible" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Drible</span><span id="drible_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="drible" name="Drible" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="passe_curto" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Passe Curto</span><span id="passe_curto_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="passe_curto" name="Passe Curto" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="passe_longo" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Passe Longo</span><span id="passe_longo_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="passe_longo" name="Passe Longo" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="finalizacao" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Finalização</span><span id="finalizacao_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="finalizacao" name="Finalizacao" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="cabeceio" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Cabeceio</span><span id="cabeceio_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="cabeceio" name="Cabeceio" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="desarme" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Desarme</span><span id="desarme_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="desarme" name="Desarme" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="visao_jogo" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Visão de Jogo</span><span id="visao_jogo_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="visao_jogo" name="Visao de Jogo" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="compostura" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Compostura</span><span id="compostura_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="compostura" name="Compostura" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
            <div class="slider-container">
              <label for="agressividade" class="flex justify-between text-sm font-medium text-gray-300 mb-1"><span>Agressividade</span><span id="agressividade_value" class="font-bold text-orange-400">5</span></label>
              <input type="range" id="agressividade" name="Agressividade" min="0" max="10" step="1" value="5" class="w-full skill-slider">
            </div>
          </div>
        </section>

        <!-- Botão de Análise -->
        <div class="flex justify-center mt-10">
          <button id="analisarBtn" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg">
            Gerar Análise com IA
          </button>
        </div>

      </main>
      </div>

      <!-- Resultados -->
      <div id="results" class="hidden mt-12">
        <div id="loading" class="hidden text-center">
          <p class="text-lg text-orange-400">Analisando dados com a IA do Gemini...</p>
          <div class="spinner"></div>
        </div>
        <div id="results-content" class="hidden bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700 space-y-6">
          <h2 class="text-3xl font-bold text-center mb-4 text-orange-400" id="report-title"></h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-gray-700 p-4 rounded-lg chart-container">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Visualização de Habilidades</h3>
              <canvas id="skillChart"></canvas>
            </div>
            <div class="bg-gray-700 p-4 rounded-lg">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Relatório da IA</h3>
              <div id="ia-analysis"></div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-gray-700 p-4 rounded-lg">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Comparativos e Insights</h3>
              <div id="player-comparison"></div>
            </div>
            <div class="bg-gray-700 p-4 rounded-lg">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Plano de Treinamento Sugerido</h3>
              <div id="training-plan"></div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-gray-700 p-4 rounded-lg">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Análise Quantitativa</h3>
              <div id="eval-summary-content"></div>
            </div>
            <div class="bg-gray-700 p-4 rounded-lg">
              <h3 class="text-xl font-semibold text-orange-500 mb-3">Scores por Posição</h3>
              <div id="eval-positions-content"></div>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- /#protected-content -->

  </div> <!-- /.container -->

  <!-- JS da navegação (não interfere no script.js principal) -->
  <script>
    (function(){
      const toggle = document.getElementById('nav-toggle');
      const drawer = document.getElementById('nav-drawer');
      const links = document.querySelectorAll('a.nav-link');

      toggle && toggle.addEventListener('click', () => {
        drawer.classList.toggle('hidden');
      });

      links.forEach(a => {
        a.addEventListener('click', () => {
          if (!drawer.classList.contains('hidden')) drawer.classList.add('hidden');
        });
      });

      const sections = Array.from(links).map(a => {
        const id = a.getAttribute('href') || '';
        try { return document.querySelector(id); } catch { return null; }
      }).filter(Boolean);

      const map = new Map();
      links.forEach(a => map.set(a.getAttribute('href'), a));

      function setActive(href) {
        links.forEach(l => l.classList.remove('text-white', 'font-semibold'));
        const el = map.get(href);
        if (el) el.classList.add('text-white', 'font-semibold');
      }

      const obs = new IntersectionObserver((entries) => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (visible && visible.target && visible.target.id) {
          setActive('#' + visible.target.id);
        }
      }, { rootMargin: '-40% 0px -50% 0px', threshold: [0.2, 0.4, 0.6, 0.8, 1] });

      sections.forEach(sec => obs.observe(sec));

      setTimeout(() => { setActive('#auth-section'); }, 300);
    })();
  </script>
</body>
</html>

